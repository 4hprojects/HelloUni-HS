<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>DSALGO1 Finals – Part 4 (Graph Representations)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- External CSS -->
    <link rel="stylesheet" href="/activity/dsalgo1/css/part4.css">
    
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Tab monitoring script -->
    <script src="/activity/dsalgo1/js/tabMonitor.js"></script>
    
    <style>
        /* Additional inline styles */
        .loading-spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
            margin-right: 8px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .time-remaining {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 10px 15px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            font-weight: 600;
            z-index: 1000;
            border-left: 4px solid #7c3aed;
        }
        
        @media print {
            .time-remaining, .navigation {
                display: none !important;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Time Remaining Display -->
        <div class="time-remaining" id="timeRemaining">
            <i class="fas fa-clock"></i> Time: <span id="timerDisplay">--:--</span>
        </div>
        
        <!-- Header -->
        <header class="header">
            <h1><i class="fas fa-network-wired"></i> DSALGO1 Finals – Part 4</h1>
            <p class="subtitle">
                This part focuses on graph representations. You will move from an adjacency list,
                to the edge list, then to an adjacency matrix.
            </p>
        </header>

        <!-- Student Information Panel -->
        <section class="info-panel">
            <h2><i class="fas fa-user-graduate"></i> Student Information</h2>
            <div class="info-grid">
                <div class="info-item">
                    <span class="info-label">Student ID Number</span>
                    <span class="info-value" id="studentIDNumberDisplay">[loading...]</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Name</span>
                    <span class="info-value" id="studentNameDisplay">[loading...]</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Section</span>
                    <span class="info-value" id="sectionDisplay">[loading...]</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Exam ID</span>
                    <span class="info-value">dsalgo1-finals</span>
                </div>
            </div>
        </section>

        <!-- Main Form -->
        <form id="part4Form">
            <input type="hidden" id="examID" name="examID" value="dsalgo1-finals">

            <!-- Status Messages -->
            <div id="message" class="message"></div>

            <!-- Two-column layout for adjacency list and edge list -->
            <div class="adj-edge-row">
                <!-- Left: Adjacency List -->
                <section class="adjacency-container">
                    <div class="adjacency-title">
                        <h3><i class="fas fa-list"></i> Generated Adjacency List</h3>
                        <span class="hint">Treat the graph as undirected</span>
                    </div>
                    <div class="adjacency-list" id="adjacencyListDisplay">
                        <p style="color: #666; text-align: center;">Loading adjacency list...</p>
                    </div>
                </section>
                <!-- Right: Unique Edges -->
                <div class="edge-list-panel">
                    <h3>1. List all unique edges</h3>
                    <p class="edge-format-hint">
                        <strong>Format:</strong> Use <code>X-Y</code> with vertices in ascending order inside the pair 
                        (e.g., <code>A-B</code>, not <code>B-A</code>).
                    </p>
                    <div class="edge-list-controls">
                        <button type="button" id="addEdgeBtn" class="btn btn-success">
                            <i class="fas fa-plus"></i> Add Edge
                        </button>
                        <span class="hint">Click to add more edges</span>
                    </div>
                    <div id="edgeListContainer" class="edge-list">
                        <!-- Edge rows will be dynamically added here -->
                    </div>
                </div>
            </div>

            <!-- Part 4 Section -->
            <section class="section" id="section-part4">
                <div class="section-header">
                    <div class="section-title">
                        <span class="section-icon">4</span>
                        <h2><i class="fas fa-sitemap"></i> Part 4: From Edge List to Adjacency Matrix</h2>
                    </div>
                    <span class="section-progress">0/0 (0%)</span>
                </div>
                
                <div class="section-description">
                    <p>Analyze the adjacency list above and complete the following tasks to represent the graph in different formats.</p>
                </div>

                <!-- Question 2: Graph Builder -->
                <div class="graph-builder-container">
                    <h3>2. Graph Builder</h3>
                    <p>Draw the graph based on the edges you listed above. Enter the number of vertices, label each vertex, and connect vertices by clicking them.</p>
                    
                    <div class="graph-controls">
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                            <label for="vertexCountInput">Number of vertices:</label>
                            <input type="number" id="vertexCountInput" min="2" max="10" value="5" class="vertex-count-input">
                        </div>
                        <span class="hint">Click vertices to select them, then click another vertex to create an edge</span>
                    </div>
                    
                    <div id="vertexLabelsContainer" class="vertex-labels-container"></div>
                    
                    <div class="graph-canvas-container">
                        <div id="graphCanvas"></div>
                    </div>
                    
                    <div id="edgeListDisplay" class="edge-list-display"></div>
                </div>

                <!-- Question 3: Adjacency Matrix -->
                <div class="matrix-builder-container">
                    <h3>3. Adjacency Matrix</h3>
                    <p>Build the adjacency matrix for this graph. Enter <code>1</code> if there is an edge, <code>0</code> if there is none.</p>
                    
                    <div class="matrix-controls">
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                            <label for="matrixSizeInput">Matrix size:</label>
                            <input type="number" id="matrixSizeInput" min="2" max="10" value="5" class="matrix-size-input">
                        </div>
                        <span class="hint">The matrix should be symmetric across the diagonal for undirected graphs</span>
                    </div>
                    
                    <div id="matrixLabelsContainer" class="matrix-labels-container"></div>
                    
                    <div id="matrixTableWrapper"></div>
                </div>

                <!-- Warning Note -->
                <div class="warning-note">
                    <strong><i class="fas fa-exclamation-triangle"></i> Important:</strong>
                    Any extra or invalid answers (such as extra edges, labels, or matrix entries) will result in a deduction from your score. The minimum possible score is zero.
                </div>

                <!-- Save Button -->
                <div style="text-align: right; margin-top: 2rem;">
                    <button type="button" id="savePart4Btn" class="btn btn-success">
                        <i class="fas fa-save"></i> Save Part 4 Progress
                    </button>
                    <span id="savePart4Status" style="margin-left: 1rem; color: #059669; font-weight: 500;"></span>
                </div>
            </section>

            <!-- Navigation & Submit -->
            <nav class="navigation">
                <div class="controls">
                    <a href="/activity/dsalgo1/dsalgo1-finals-part3" class="btn btn-secondary">
                        <i class="fas fa-arrow-left"></i> Back to Part 3
                    </a>
                    
                    <div class="progress-bar">
                        <div class="progress-info">
                            <span id="answeredCount">0</span> fields answered
                            <span id="progressPercentage">0%</span>
                        </div>
                        <div class="progress-track">
                            <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                        </div>
                    </div>
                    
                    <button type="submit" class="btn btn-primary" id="submitBtn">
                        <i class="fas fa-paper-plane"></i> Submit Part 4 (0/0)
                    </button>
                </div>
                
                <!-- Quick navigation hint -->
                <div style="text-align: center; margin-top: 10px; font-size: 0.875rem; color: #666;">
                    <small>Tip: Answers are auto-saved every 30 seconds. Use Ctrl+S to save manually.</small>
                </div>
            </nav>
        </form>
    </div>

    <!-- Timer Script -->
    <script>
        // Timer functionality (60 minutes for the exam)
        let examTimer = 60 * 60;
        const timerDisplay = document.getElementById('timerDisplay');
        const timeRemaining = document.getElementById('timeRemaining');
        
        function updateTimer() {
            if (!timerDisplay) return;
            
            const minutes = Math.floor(examTimer / 60);
            const seconds = examTimer % 60;
            timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            if (examTimer <= 600) { // 10 minutes
                timeRemaining.style.borderLeftColor = '#ef4444';
                timeRemaining.style.color = '#ef4444';
                
                if (examTimer <= 300) { // 5 minutes
                    timeRemaining.style.opacity = (Math.sin(Date.now() / 500) + 1) / 2;
                }
            }
            
            if (examTimer > 0) {
                examTimer--;
            }
        }
        
        let timerInterval;
        document.addEventListener('DOMContentLoaded', () => {
            timerInterval = setInterval(updateTimer, 1000);
        });
        
        // Prevent accidental refresh
        window.addEventListener('beforeunload', (e) => {
            const form = document.getElementById('part4Form');
            if (form) {
                const answeredCount = Object.keys(window.currentAnswers || {}).length;
                if (answeredCount > 0 && !window.isNavigatingAway) {
                    e.preventDefault();
                    e.returnValue = 'You have unsaved answers. Are you sure you want to leave?';
                }
            }
        });
    </script>

    <!-- External JavaScript -->
    <script src="/activity/dsalgo1/js/part4.js" defer></script>
</body>
</html>
